---
layout: default
title: Search
permalink: /pages/fisbroker/search/
level: 2
---

<div class="container">
    <div class="row">
		<div class="col col-md-2 col-lg-3"></div>
		<div class="col col-sm-12 col-md-8 col-lg-6">
            <input type="text" id="searchslot" />
        </div>
        <div class="col col-md-2 col-lg-3"></div>
    </div>
    <div class="row">
		<div class="col col-md-2 col-lg-3"></div>
		<div class="col col-sm-12 col-md-8 col-lg-6">
            <a id="taglink">Toggle TagCloud</a><br />
            <div id="tagcloud">

            </div>
        </div>
        <div class="col col-md-2 col-lg-3"></div>
    </div>
    <div class="row">
		<div class="col col-md-2 col-lg-3"></div>
		<div class="col col-sm-12 col-md-8 col-lg-6">
            <a id="catlink">Toggle Categories</a><br />
            <div id="categories">

            </div>
        </div>
        <div class="col col-md-2 col-lg-3"></div>
    </div>
    <div class="row">
		<div class="col col-md-2 col-lg-3"></div>
		<div class="col col-sm-12 col-md-8 col-lg-6">
            <div id="types">
                <div>
                    <label>All</label>
                    <input type="radio" name="type" value="all" class="typetoggle" />
                </div>
                <div>
                    <label>WFS</label>
                    <input type="radio" name="type" value="wfs" class="typetoggle" />
                </div>
                <div>
                    <label>WMS</label>
                    <input type="radio" name="type" value="wms" class="typetoggle" />
                </div>
                <div>
                    <label>FEED</label>
                    <input type="radio" name="type" value="feed" class="typetoggle" />
                </div>
            </div>
        </div>
        <div class="col col-md-2 col-lg-3"></div>
    </div>
    <div class="row">
		<div class="col col-md-2 col-lg-3"></div>
		<div class="col col-sm-12 col-md-8 col-lg-6">
            <table>
                <thead>
                    <tr>
                        <th>Preview</th>
                        <th>Title</th>
                        <th>Type</th>
                    </tr>
                </thead>
                <tbody id="table">
                </tbody>
                <thead>
                    <tr>
                        <th>Preview</th>
                        <th>Title</th>
                        <th>Type</th>
                    </tr>
                </thead>
            </table>
        </div>
        <div class="col col-md-2 col-lg-3"></div>
    </div>
</div>
<script src="{{ site.url }}/lib/d3.min.js"></script>
<script src="{{ site.url }}/lib/topojson.v1.min.js"></script>
<script src="{{ site.url }}/lib/lunr.min.js"></script>
<script>

    var url = "{{site.url}}";

    var index = lunr(function () {
        this.field('type');
        this.field('name');
        this.field('title');
        this.field('description');
        this.field('keywords');
        this.field('thumb');
        this.field('category');
        this.ref('id');
    });

    var keywords = {}, categories = {};

    d3.json('{{ site.url }}/data/tools/fisbroker/light.json', function(data){

        for(var i = 0; i<data.length; i++){
            var tkeywordstr = "";
            if($.isArray(data[i][4])){
                tkeywordstr = data[i][4].join();
            }
            index.add({
                type: data[i][0],
                name: data[i][1],
                title: data[i][2],
                description: data[i][3],
                keywords: tkeywordstr,
                thumb: data[i][5],
                category: data[i][6],
                id: i
            });

            if($.isArray(data[i][4])){
                for(var j = 0; j<data[i][4].length; j++){
                    if(data[i][4][j] in keywords){
                        keywords[data[i][4][j]]++;
                    }else{
                        keywords[data[i][4][j]] = 1;
                    }
                }
            }

            if(data[i][6] in categories){
                categories[data[i][6]]++;
            }else{
                categories[data[i][6]]=1;
            }
        }

        var keys = [];
        var min = Number.MAX_VALUE,
            max = -Number.MAX_VALUE;

        for(var key in keywords){
            keys.push({
                t:key,
                c:keywords[key]
            });
            if(keywords[key] < min){min = keywords[key];}
            if(keywords[key] > max){max = keywords[key];}
        }

        var size = d3.scale.linear().domain([min,max]).range([10,20]);

        var cats = [];
        for(var key in categories){
            keys.push({
                t:key,
                c:categories[key]
            });
        }

        d3.select('#categories').selectAll('a').data(cats).enter().append('a')
            .text(function(d){ return d.t+" ("+d.c+")"; });

        d3.select('#tagcloud').selectAll('a').data(keys).enter().append('a')
            .text(function(d){return d.t;})
            .style('display', function(d){ if(d.c >= 5){ return "inline-block"; }else{ return "none"; } })
            .style('font-size', function(d){ return size(d.c)+"px"; });

        var tr = d3.select('#table').selectAll('tr').data(data).enter().append('tr');
        tr.append('td').html(function(d){ if(d[5] === false){ return ""; }else{return "<img src='"+url+"/data/tools/fisbroker/thumbs/small/"+d[5]+"' />";} });
        tr.append('td').text(function(d){return d[2]; });
        tr.append('td').text(function(d){return d[0]; });
    });

</script>
